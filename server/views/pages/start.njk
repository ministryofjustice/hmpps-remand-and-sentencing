{% extends "../partials/prisonerBannerLayout.njk" %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/table/macro.njk" import govukTable %}

{% set pageTitle = applicationName + " - Home" %}



{% block content %}
    <h1>Start Page</h1>
    <div class="govuk-grid-row">

        <div class="govuk-grid-column-two-thirds">
            
            {% for courtCaseDetails in courtCaseDetailModels %}

                {% set courtCaseSummary %}

                    {% set nextHearingHtml %}
                        <ul class="govuk-list">
                            {% for nextHearingValue in courtCaseDetails.nextHearing %}
                                <li> {{ nextHearingValue }} </li>
                            {% endfor %}
                        </ul>
                    {% endset %}
                    {{
                        govukSummaryList({
                            rows: [
                            {
                                key: { text: "Case references"},
                                value: { text: courtCaseDetails.caseReferences }
                            },
                            {
                                key: { text: "Overall case outcome"},
                                value: { text: courtCaseDetails.overallCaseOutcome }
                            },
                            {
                                key: { text: "Next hearing"},
                                value: { html: nextHearingHtml }
                            }
                            ],
                            attributes: {
                                "data-qa": "courtCaseSummary-" + courtCaseDetails.courtCaseUuid
                            }
                        })
                    }}

                    <hr class="govuk-section-break govuk-section-break--visible">

                    {%- set appearanceTableRows = [] -%}

                    {%- for appearance in courtCaseDetails.latestAppearances -%}
                        {%- set tableRow= [
                            {
                                text: appearance.courtCaseReference
                            },
                            {
                                text: appearance.courtCode
                            },
                            {
                                text: appearance.appearanceDate | formatDate
                            },
                            {
                                text: appearance.outcome
                            },
                            {
                                html: '<a href="/person/' + nomsId + '/view-appearance/' + appearance.appearanceUuid + '">View and edit</a>'
                            }
                        ]-%}
                        {% set appearanceTableRows = (appearanceTableRows.push(tableRow), appearanceTableRows)%}
                    {%- endfor -%}

                    {{ govukTable({
                        classes: 'govuk-!-margin-top-6',
                        caption: 'Appearances (' + ('showing ' + courtCaseDetails.showingAppearanceTotal + ' of ' + courtCaseDetails.appearanceTotal if courtCaseDetails.showingAppearanceTotal else courtCaseDetails.appearanceTotal) + ')',
                        captionClasses: "govuk-table__caption--m",
                        head: [
                            {
                            text: "Case reference"
                            },
                            {
                            text: "Location"
                            },
                            {
                            text: "Warrant date"
                            },
                            {
                            text: "Outcome"
                            },
                            {
                            text: ""
                            }
                        ],
                        rows: appearanceTableRows,
                            attributes: {
                                "data-qa": "courtCaseAppearanceTable-" + courtCaseDetails.courtCaseUuid
                            }
                    }) }}

                {% endset %}

                {{
                    govukSummaryList({
                        card: {
                            title: {
                                text: "Court Case " + courtCaseDetails.courtCaseUuid
                            },
                            actions: {
                                items: [
                                {
                                    href: "/person/" + nomsId + "/edit-court-case/" + courtCaseDetails.courtCaseUuid + "/appearance/"+ courtCaseDetails.appearanceTotal + "/select-reference",
                                    text: "Add an appearance",
                                    visuallyHiddenText: "Add an appearance"
                                }]
                            }
                        },
                        rows: [
                        {
                            key: { text: "", classes: 'govuk-!-display-none' },
                            value: { html: courtCaseSummary }
                        }]
                    })
                }}

            {% endfor %}

        </div>

        <div class="govuk-grid-column-one-third">
        {{ govukButton({
            text: "Add a court case",
            href: "/person/" + nomsId + "/add-court-case/" + newCourtCaseId + "/appearance/0/reference"
        }) }}
        </div>
    </div>

{% endblock %}